<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Golf Score Card</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/style.css">

    <script src="js/editablegrid.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_renderers.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_editors.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_validators.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_utils.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_charts.js"></script>
    <link rel="stylesheet" href="css/editablegrid.css" type="text/css" media="screen">

    <style>
        body {
            font-family: 'lucida grande', tahoma, verdana, arial, sans-serif;
            font-size: 11px;
        }

        h1 {
            font-size: 15px;
        }

        a {
            color: #548dc4;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        table.testgrid {
            border-collapse: collapse;
            border: 1px solid #CCB;
            width: 800px;
        }

        table.testgrid td, table.testgrid th {
            padding: 5px;
            border: 1px solid #E0E0E0;
        }

        table.testgrid th {
            background: #E5E5E5;
            text-align: left;
        }

        input.invalid {
            background: red;
            color: #FDFDFD;
        }
    </style>

    <script>
        window.onload = function () {
            editableGrid = new EditableGrid("DemoGridAttach", {sortIconUp: "up.png", sortIconDown: "down.png"});

            // we build and load the metadata in Javascript
            editableGrid.load({
                metadata: [
                    {name: "name", datatype: "string", editable: true},
                    {name: "hole1", datatype: "string", editable: true},
                    {name: "hole2", datatype: "string", editable: true},
                    {name: "hole3", datatype: "string", editable: true},
                    {name: "hole4", datatype: "string", editable: true},
                    {name: "hole5", datatype: "string", editable: true},
                    {name: "hole6", datatype: "string", editable: true},
                    {name: "hole7", datatype: "string", editable: true},
                    {name: "hole8", datatype: "string", editable: true},
                    {name: "hole9", datatype: "string", editable: true},
                    {name: "total", datatype: "string", editable: false}
                ]
            });

            // then we attach to the HTML table and render it
            editableGrid.attachToHTMLTable('playersTable');
            editableGrid.renderGrid();
        }
    </script>

</head>

<body>
<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo logos">Golf Score Card</a>
        <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down">
            <li><a href="#" onclick="settings()">Settings</a></li>
        </ul>
        <ul class="side-nav" id="mobile-demo">
            <li><a href="#" onclick="settings()">Settings</a></li>
        </ul>
    </div>
</nav>
<div id="map"></div>
<div id="courseInfo"></div>
<section id="tables">
    <h1>Score Card</h1>
    <table id="playersTable" class="testgrid">
        <tr id="pHeading">
            <th>Name</th>
            <th>Hole 1</th>
            <th>Hole 2</th>
            <th>Hole 3</th>
            <th>Hole 4</th>
            <th>Hole 5</th>
            <th>Hole 6</th>
            <th>Hole 7</th>
            <th>Hole 8</th>
            <th>Hole 9</th>
            <th>Totals</th>
        </tr>
        <tr id="R1">
            <td>Duke</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R2">
            <td>Juniof</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R3">
            <td>Dujardin</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>5000</td>
        </tr>
        <tr id="R4">
            <td>Conway</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R5">
            <td>Shannon</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R6">
            <td>Benton</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R7">
            <td>Belletoise</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R8">
            <td>Santa-Maria</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R9">
            <td>Dieumerci</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr id="R10">
            <td>Morin</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</section>
<div id="boxes">
    <div id="dialog" class="window">
        <div class="holder">
            <form class="col s12 m6">
                <label>Tee Box Selection</label>
                <select class="browser-default" id="tee">
                    <option value="" disabled selected>Choose your Tee Box</option>
                    <option value="men">Men's</option>
                    <option value="women">Women's</option>
                    <option value="champion">Champion</option>
                    <option value="professional">Professional</option>
                </select>
                <label>Hole Selection</label>
                <select class="browser-default" id="holecount">
                    <option value="" disabled selected>Choose how many Holes</option>
                    <option value=9>9 Holes</option>
                    <option value=18>18 Holes</option>
                </select>
                <input type="submit" class="close agree" value="Save Settings" onclick="submitSettings()">
            </form>
        </div>
    </div>
    <!--<div class="row"><button onclick = "Add9Holes(); Men9Marker(); remove9holes();">Add 9 Holes/Men</button>-->

</div>
</div>
<div id="mask"></div>
</div>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
<script>
    var wIcon = 'img/purplebox-woman.png';
    var mIcon = 'img/bluebox-men.png';
    var cIcon = 'img/graybox-champion.png';
    var pIcon = 'img/blackbox-professional.png';

    var redirectURI = document.URL;
    var clientID = "a88e7b45-fa45-4d05-829e-975681adc580";
    var model;

    var accessToken = getUrlVars().access_token;
    var swingBySwing = "https://api.swingbyswing.com/v2/oauth/authorize?scope=read&redirect_uri=" + encodeURI(redirectURI) + "&response_type=token&client_id=" + clientID;
    if (accessToken == null) {
        location.replace(swingBySwing);
    }
    else {
        accessToken = accessToken.replace("\n", "");
        getCourse(51763);
    }
    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
                function (m, key, value) {
                    vars[key] = value;
                });
        return vars;
    }
    var map;
    function getCourse(courseId) {
        var xhttp = new XMLHttpRequest();
        var swingLink = "https://api.swingbyswing.com/v2/courses/" + courseId + "?includes=practice_area&access_token=" + accessToken;

        xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                model = JSON.parse(xhttp.responseText);
                var location = model.course.location;
                initMap(location);
            }
        };
        xhttp.open("GET", swingLink, true);
        xhttp.send();
    }

    function initMap(location) {
        map = new google.maps.Map(document.getElementById('map'), {
            center: location,
            zoom: 20
        });

        var marker = new google.maps.Marker({
            position: location,
            map: map,
            title: "Old St. Andrews"
        });
    }
    function submitSettings(holecount, tee) {
        tee = document.getElementById("tee").value;
        holecount = document.getElementById("holecount").value;
        addHoles(holecount);
        addTeeBox(holecount, tee);
        if (holecount == 18) {
            var index = 10;

            for (var i = 0; i < 9; i++) {
                var hole = "Hole " + index;
                addCol(hole);
                index++;
            }
        }

    }
    function addHoles(holecount) {
        for (var i = 0; i < holecount; i++) {
            var hole = model.course.holes[i].green_location;
            addHMarker(hole);
        }
    }
    function addTeeBox(holecount, tee) {
        var index;
        var teebox;
        if (tee == "men") {
            index = 0;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, mIcon);
            }
        }
        if (tee == "women") {
            index = 1;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, wIcon);
            }
        }
        if (tee == "champion") {
            index = 2;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, cIcon);
            }
        }
        if (tee == "professional") {
            index = 3;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, pIcon);
            }
        }

    }
    function addHMarker(location) {
        var marker = new google.maps.Marker({
            position: location,
            map: map
        });
    }
    function addMarker(location, icon) {
        var marker = new google.maps.Marker({
            position: location,
            map: map,
            icon: icon
        });
    }
    function settings() {
        var id = '#dialog';


        var maskHeight = $(document).height();
        var maskWidth = $(window).width();

        $('#mask').css({'width': maskWidth, 'height': maskHeight});

        $('#mask').fadeIn(500);
        $('#mask').fadeTo("slow", 0.9);

        var winH = $(window).height();
        var winW = $(window).width();

        $(id).css('top', winH / 2 - $(id).height() / 2);
        $(id).css('left', winW / 2 - $(id).width() / 2);

        $(id).fadeIn(2000);

        $('.window .close').click(function (e) {
            e.preventDefault();

            $('#mask').hide();
            $('.window').hide();
        });

        $('#mask').click(function () {
            $(this).hide();
            $('.window').hide();
        });

    }
    $(document).ready(settings());

    function addCol(colName) {
        $("#playersTable #pHeading").each(function () {
            $(this).append("<th>" + colName + "</th>");
        })
    }

    //editable table here//

    var $TABLE = $('#table');

    $('.table-add').click(function () {
        var $clone = $TABLE.find('tr.hide').clone(true).removeClass('hide table-line');
        $TABLE.find('table').append($clone);
    });

    $('.table-remove').click(function () {
        $(this).parents('tr').detach();
    });

    $('.table-up').click(function () {
        var $row = $(this).parents('tr');
        if ($row.index() === 1) return; // Don't go above the header
        $row.prev().before($row.get(0));
    });

    $('.table-down').click(function () {
        var $row = $(this).parents('tr');
        $row.next().after($row.get(0));
    });

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzseJI9tag50xHhEFstcLwOufPGBYqZnk&signed_in=true&callback=initMap"></script>
</body>
</html>
