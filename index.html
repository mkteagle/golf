<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Golf Score Card</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/style.css">

    <script src="js/editablegrid.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_renderers.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_editors.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_validators.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_utils.js"></script>
    <!-- [DO NOT DEPLOY] -->
    <script src="js/editablegrid_charts.js"></script>
    <link rel="stylesheet" href="css/editablegrid.css" type="text/css" media="screen">

    <style>
       a {
            color: #548dc4;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        table.testgrid {
            border-collapse: collapse;
            border: 1px solid #CCB;
            width: 95%;
        }

        table.testgrid td, table.testgrid th {
            padding: 5px;
            border: 1px solid #E0E0E0;
        }

        table.testgrid th {
            background: #E5E5E5;
            text-align: left;
        }

        input.invalid {
            background: red;
            color: #FDFDFD;
        }
    </style>

    <script>
        window.onload = function () {
            editableGrid = new EditableGrid("DemoGridAttach", {
                sortIconUp: "<i class='fa fa-sort-amount-asc'></i>",
                sortIconDown: "<i class='fa fa-sort-amount-dec'></i>"
            });

            // we build and load the metadata in Javascript
            editableGrid.load({
                metadata: [
                    {name: "name", datatype: "string", editable: true},
                    {name: "hole1", datatype: "string", editable: true},
                    {name: "hole2", datatype: "string", editable: true},
                    {name: "hole3", datatype: "string", editable: true},
                    {name: "hole4", datatype: "string", editable: true},
                    {name: "hole5", datatype: "string", editable: true},
                    {name: "hole6", datatype: "string", editable: true},
                    {name: "hole7", datatype: "string", editable: true},
                    {name: "hole8", datatype: "string", editable: true},
                    {name: "hole9", datatype: "string", editable: true},
                    {name: "totals9", datatype: "string", editable: false},
                    {name: "hole10", datatype: "string", editable: true},
                    {name: "hole11", datatype: "string", editable: true},
                    {name: "hole12", datatype: "string", editable: true},
                    {name: "hole13", datatype: "string", editable: true},
                    {name: "hole14", datatype: "string", editable: true},
                    {name: "hole15", datatype: "string", editable: true},
                    {name: "hole16", datatype: "string", editable: true},
                    {name: "hole17", datatype: "string", editable: true},
                    {name: "hole18", datatype: "string", editable: true},
                    {name: "totals18", datatype: "string", editable: false}
                ]
            });

            // then we attach to the HTML table and render it
            editableGrid.attachToHTMLTable('playersTable');
            editableGrid.renderGrid();
        }
    </script>

</head>

<body>
<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo logos">Golf Score Card</a>
        <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down">
            <li><a href="#" onclick="settings()">Settings</a></li>
        </ul>
        <ul class="side-nav" id="mobile-demo">
            <li><a href="#" onclick="settings()">Settings</a></li>
        </ul>
    </div>
</nav>
<div id="map"></div>
<div id="courseInfo"></div>
<section id="tables">
    <h1>Score Card</h1>
    <div id="addP" onclick="addRows()">Add Player</div>
    <div class="row">
        <div class="col s12 m6">
            <div class="card blue-grey darken-1">
                <div class="card-content white-text">
                    <span class="card-title">Legend</span>
                    <table>
                        <th></th>
                        <th>Hole 1</th>
                        <th>Hole 2</th>
                        <th>Hole 3</th>
                        <th>Hole 4</th>
                        <th>Hole 5</th>
                        <th>Hole 6</th>
                        <th>Hole 7</th>
                        <th>Hole 8</th>
                        <th>Hole 9</th>
                        <th class="hide hole10">Hole 10</th>
                        <th class="hide hole11">Hole 11</th>
                        <th class="hide hole12">Hole 12</th>
                        <th class="hide hole13">Hole 13</th>
                        <th class="hide hole14">Hole 14</th>
                        <th class="hide hole15">Hole 15</th>
                        <th class="hide hole16">Hole 16</th>
                        <th class="hide hole17">Hole 17</th>
                        <th class="hide hole18">Hole 18</th>
                        <tr><td>Par</td></tr>
                        <tr><td>Yard 1</td></tr>
                        <tr><td>Yard 2</td></tr>
                        <tr><td>Yard 3</td></tr>
                        <tr><td>Yard 4</td></tr>
                    </table>
                </div>
                <div class="card-action">
                    <a href="#">This is a link</a>
                    <a href="#">This is a link</a>
                </div>
            </div>
        </div>
    </div>
    <table id="playersTable" class="testgrid">
        <tr id="pHeading">
            <th class="playersName">Name</th>
            <th>Hole 1</th>
            <th>Hole 2</th>
            <th>Hole 3</th>
            <th>Hole 4</th>
            <th>Hole 5</th>
            <th>Hole 6</th>
            <th>Hole 7</th>
            <th>Hole 8</th>
            <th>Hole 9</th>
            <th class="totals9">Totals</th>
            <th class="hide hole10">Hole 10</th>
            <th class="hide hole11">Hole 11</th>
            <th class="hide hole12">Hole 12</th>
            <th class="hide hole13">Hole 13</th>
            <th class="hide hole14">Hole 14</th>
            <th class="hide hole15">Hole 15</th>
            <th class="hide hole16">Hole 16</th>
            <th class="hide hole17">Hole 17</th>
            <th class="hide hole18">Hole 18</th>
            <th class="totals18 hide">Totals</th>

        </tr>
        <tr id="R1">
            <td class="playersName">Mike Teagle</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="totals9"></td>
            <td class="hide hole10"></td>
            <td class="hide hole11"></td>
            <td class="hide hole12"></td>
            <td class="hide hole13"></td>
            <td class="hide hole14"></td>
            <td class="hide hole15"></td>
            <td class="hide hole16"></td>
            <td class="hide hole17"></td>
            <td class="hide hole18"></td>
            <td class="totals18 hide"></td>
        </tr>
        <tr id="R2">
            <td class="playersName">Jen Teagle</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="totals9"></td>
            <td class="hide hole10"></td>
            <td class="hide hole11"></td>
            <td class="hide hole12"></td>
            <td class="hide hole13"></td>
            <td class="hide hole14"></td>
            <td class="hide hole15"></td>
            <td class="hide hole16"></td>
            <td class="hide hole17"></td>
            <td class="hide hole18"></td>
            <td class="totals18 hide"></td>
        </tr>
        <tr id="R3">
            <td class="playersName">Madison Teagle</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="totals9"></td>
            <td class="hide hole10"></td>
            <td class="hide hole11"></td>
            <td class="hide hole12"></td>
            <td class="hide hole13"></td>
            <td class="hide hole14"></td>
            <td class="hide hole15"></td>
            <td class="hide hole16"></td>
            <td class="hide hole17"></td>
            <td class="hide hole18"></td>
            <td class="totals18 hide"></td>
        </tr>
        <tr id="R4">
            <td class="playersName">Britain Teagle</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="totals9"></td>
            <td class="hide hole10"></td>
            <td class="hide hole11"></td>
            <td class="hide hole12"></td>
            <td class="hide hole13"></td>
            <td class="hide hole14"></td>
            <td class="hide hole15"></td>
            <td class="hide hole16"></td>
            <td class="hide hole17"></td>
            <td class="hide hole18"></td>
            <td class="totals18 hide"></td>
        </tr>
    </table>
</section>
<div id="boxes">
    <div id="dialog" class="window">
        <div class="holder">
            <form class="col s12 m6">
                <label>Tee Box Selection</label>
                <select class="browser-default" id="tee">
                    <option value="" disabled selected>Choose your Tee Box</option>
                    <option value="men">Men's</option>
                    <option value="women">Women's</option>
                    <option value="champion">Champion</option>
                    <option value="professional">Professional</option>
                </select>
                <label>Hole Selection</label>
                <select class="browser-default" id="holecount">
                    <option value="" disabled selected>Choose how many Holes</option>
                    <option value=9>9 Holes</option>
                    <option value=18>18 Holes</option>
                </select>
                <input type="submit" class="close agree" value="Save Settings" onclick="submitSettings()">
                <button class="close agree" onclick="deleteMarkers()">Clear Markers</button>
            </form>
        </div>
    </div>
</div>
</div>
<div id="mask"></div>
</div>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
<script>
    var wIcon = 'img/purplebox-woman.png';
    var mIcon = 'img/bluebox-men.png';
    var cIcon = 'img/graybox-champion.png';
    var pIcon = 'img/blackbox-professional.png';
    var redirectURI = document.URL;
    var clientID = "a88e7b45-fa45-4d05-829e-975681adc580";
    var model;
    var map;
    var markers = [];

    var accessToken = getUrlVars().access_token;
    var swingBySwing = "https://api.swingbyswing.com/v2/oauth/authorize?scope=read&redirect_uri=" + encodeURI(redirectURI) + "&response_type=token&client_id=" + clientID;
    if (accessToken == null) {
        location.replace(swingBySwing);
    }
    else {
        accessToken = accessToken.replace("\n", "");
        getCourse(51763);
    }
    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
                function (m, key, value) {
                    vars[key] = value;
                });
        return vars;
    }

    function getCourse(courseId) {
        var xhttp = new XMLHttpRequest();
        var swingLink = "https://api.swingbyswing.com/v2/courses/" + courseId + "?includes=practice_area&access_token=" + accessToken;

        xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                model = JSON.parse(xhttp.responseText);
                var location = model.course.location;
                initMap(location);
            }
        };
        xhttp.open("GET", swingLink, true);
        xhttp.send();
    }

    function initMap(location) {
        map = new google.maps.Map(document.getElementById('map'), {
            center: location,
            zoom: 20
        });

        var marker = new google.maps.Marker({
            position: location,
            map: map,
            title: "Old St. Andrews"
        });
    }
    function submitSettings(holecount, tee) {
        var tee = document.getElementById("tee").value;
        var holecount = document.getElementById("holecount").value;
        addHoles(holecount);
        addTeeBox(holecount, tee);
        if (holecount == 18) {
            addClass(holecount);
        }
        if (holecount == 9) {
            removeClass(holecount, tee);
        }
    }
    function addHoles(holecount) {
        for (var i = 0; i < holecount; i++) {
            var hole = model.course.holes[i].green_location;
            addHMarker(hole);
        }
    }
    function addTeeBox(holecount, tee) {
        var index;
        var teebox;
        if (tee == "men") {
            index = 0;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, mIcon);
            }
        }
        if (tee == "women") {
            index = 1;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, wIcon);
            }
        }
        if (tee == "champion") {
            index = 2;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, cIcon);
            }
        }
        if (tee == "professional") {
            index = 3;
            for (var i = 0; i < holecount; i++) {
                teebox = model.course.holes[i].tee_boxes[index].location;
                addMarker(teebox, pIcon);
            }
        }

    }
    function addHMarker(location) {
        var marker = new google.maps.Marker({
            position: location,
            map: map
        });
        markers.push(marker);
    }
    function addMarker(location, icon) {
        var marker = new google.maps.Marker({
            position: location,
            map: map,
            icon: icon
        });
        markers.push(marker);
    }
    function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(map);
        }
    }
    function clearMarkers() {
        setMapOnAll(null);
    }

    function deleteMarkers() {
        clearMarkers();
        markers = [];
    }
    function settings() {
        var id = '#dialog';


        var maskHeight = $(document).height();
        var maskWidth = $(window).width();

        $('#mask').css({'width': maskWidth, 'height': maskHeight});

        $('#mask').fadeIn(500);
        $('#mask').fadeTo("slow", 0.9);

        var winH = $(window).height();
        var winW = $(window).width();

        $(id).css('top', winH / 2 - $(id).height() / 2);
        $(id).css('left', winW / 2 - $(id).width() / 2);

        $(id).fadeIn(2000);

        $('.window .close').click(function (e) {
            e.preventDefault();

            $('#mask').hide();
            $('.window').hide();
        });

        $('#mask').click(function () {
            $(this).hide();
            $('.window').hide();
        });

    }
    $(document).ready(settings());
// need a funtion to addClass to
    function addClass() {
        $('.totals9').addClass('hide');
        $('.hole10').removeClass('hide').addClass('show-cell');
        $('.hole11').removeClass('hide').addClass('show-cell');
        $('.hole12').removeClass('hide').addClass('show-cell');
        $('.hole13').removeClass('hide').addClass('show-cell');
        $('.hole14').removeClass('hide').addClass('show-cell');
        $('.hole15').removeClass('hide').addClass('show-cell');
        $('.hole16').removeClass('hide').addClass('show-cell');
        $('.hole17').removeClass('hide').addClass('show-cell');
        $('.hole18').removeClass('hide').addClass('show-cell');
        $('.totals18').removeClass('hide').addClass('show-cell');
    }
    function removeClass(holecount, tee) {
        $('.totals9').removeClass('hide').addClass('show-cell');
        $('.hole10').removeClass('show-cell').addClass('hide');
        $('.hole11').removeClass('show-cell').addClass('hide');
        $('.hole12').removeClass('show-cell').addClass('hide');
        $('.hole13').removeClass('show-cell').addClass('hide');
        $('.hole14').removeClass('show-cell').addClass('hide');
        $('.hole15').removeClass('show-cell').addClass('hide');
        $('.hole16').removeClass('show-cell').addClass('hide');
        $('.hole17').removeClass('show-cell').addClass('hide');
        $('.hole18').removeClass('show-cell').addClass('hide');
        $('.totals18').removeClass('show-cell').addClass('hide');
        deleteMarkers();
        addHoles(holecount);
        addTeeBox(holecount, tee);
    }

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzseJI9tag50xHhEFstcLwOufPGBYqZnk&signed_in=true&callback=initMap"></script>
</body>
</html>
